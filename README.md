# –ü—Ä–æ—î–∫—Ç REST API –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏

## –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ–π
- **Python 3.12**
- **FastAPI** - —Å—É—á–∞—Å–Ω–∏–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **PostgreSQL 16** - –æ—Å–Ω–æ–≤–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö
- **Redis 7** - –∫–µ—à—É–≤–∞–Ω–Ω—è —Ç–∞ —Å–µ—Å—ñ—ó
- **SQLAlchemy (Async)** - ORM –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –ë–î
- **Alembic** - –º—ñ–≥—Ä–∞—Ü—ñ—ó —Å—Ö–µ–º–∏ –ë–î
- **Pydantic v2** - –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö
- **Docker Compose** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü—ñ—è
- **pytest** - —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑ –ø–æ–∫—Ä–∏—Ç—Ç—è–º 77%

## –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –∑–∞–ø—É—Å–∫

### 1. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
```bash
poetry install
```

### 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö –æ—Ç–æ—á–µ–Ω–Ω—è
–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `.env` –∑–∞ –ø—Ä–∏–∫–ª–∞–¥–æ–º `.env.example`:
```env
# –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö
POSTGRES_USER=your_user
POSTGRES_PASSWORD=your_password
POSTGRES_DB=contacts_db
DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/contacts_db

# JWT
SECRET_KEY=your-secret-key
APP_URL=http://localhost:8000

# Cloudinary
CLOUDINARY_CLOUD_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret
```

### 3. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose
```bash
# –ó–∞–ø—É—Å–∫ –≤—Å—ñ—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ (PostgreSQL, Redis, Mailhog, FastAPI)
docker compose up -d

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É
docker compose ps
```

### 4. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏–π –∑–∞–ø—É—Å–∫ (–ª–æ–∫–∞–ª—å–Ω–∏–π)
```bash
# –ó–∞–ø—É—Å–∫ —Ç—ñ–ª—å–∫–∏ –±–∞–∑ –¥–∞–Ω–∏—Ö
docker compose up postgres redis mailhog -d

# –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ–π
alembic upgrade head

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
uvicorn app.main:app --reload
```

### 5. –î–æ—Å—Ç—É–ø –¥–æ —Å–µ—Ä–≤—ñ—Å—ñ–≤
- **API**: http://localhost:8000
- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc
- **Mailhog (—Ç–µ—Å—Ç–∏ email)**: http://localhost:8025
- **PostgreSQL**: localhost:5432
- **Redis**: localhost:6379

## –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å API

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Ç–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ
- `POST /auth/signup` ‚Äî —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- `POST /auth/login` ‚Äî –≤—Ö—ñ–¥ —Ç–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è JWT —Ç–æ–∫–µ–Ω–∞
- `GET /auth/verify` ‚Äî –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è email —á–µ—Ä–µ–∑ —Ç–æ–∫–µ–Ω
- `POST /auth/request-reset` ‚Äî –∑–∞–ø–∏—Ç –Ω–∞ —Å–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—è
- `POST /auth/reset-password` ‚Äî —Å–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—è –∑–∞ —Ç–æ–∫–µ–Ω–æ–º
- `GET /me` ‚Äî –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- `POST /me/avatar` ‚Äî –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–≤–∞—Ç–∞—Ä–∞ (Cloudinary)

### –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏
- `GET /contacts/contacts/` ‚Äî —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- `POST /contacts/contacts/` ‚Äî —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç—É
- `GET /contacts/contacts/{id}` ‚Äî –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç—É –∑–∞ ID
- `PUT /contacts/contacts/{id}` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç—É
- `DELETE /contacts/contacts/{id}` ‚Äî –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç—É
- `GET /contacts/contacts/search` ‚Äî –ø–æ—à—É–∫ –∑–∞ —ñ–º–µ–Ω–µ–º, –ø—Ä—ñ–∑–≤–∏—â–µ–º, email
- `GET /contacts/contacts/birthdays` ‚Äî –¥–Ω—ñ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è –Ω–∞–π–±–ª–∏–∂—á—ñ 7 –¥–Ω—ñ–≤

### –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è (—Ç—ñ–ª—å–∫–∏ –¥–ª—è –∞–¥–º—ñ–Ω—ñ–≤)
- `GET /admin/users` ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- `PATCH /admin/users/{id}/role` ‚Äî –∑–º—ñ–Ω–∞ —Ä–æ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

## –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

### üîê –ë–µ–∑–ø–µ–∫–∞ —Ç–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è
- **JWT —Ç–æ–∫–µ–Ω–∏** –∑ —Å–µ–∫—Ä–µ—Ç–Ω–∏–º –∫–ª—é—á–µ–º
- **Email –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è** —á–µ—Ä–µ–∑ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ —Ç–æ–∫–µ–Ω–∏
- **–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è** —á–µ—Ä–µ–∑ —Ç–æ–∫–µ–Ω–∏ –≤ Redis (1 –≥–æ–¥–∏–Ω–∞)
- **–†–æ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤**: `user` —Ç–∞ `admin`
- **–ö–µ—à—É–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤** –≤ Redis –¥–ª—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ

### üö¶ Rate Limiting
- **SlowAPI** –¥–ª—è –æ–±–º–µ–∂–µ–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤
- –ï–Ω–¥–ø–æ—ñ–Ω—Ç `/me` –æ–±–º–µ–∂–µ–Ω–æ: **5 –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ —Ö–≤–∏–ª–∏–Ω—É**

### üìÅ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤
- **Cloudinary** –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –∞–≤–∞—Ç–∞—Ä—ñ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –æ–±—Ä—ñ–∑–∫–∞ —Ç–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –∑–æ–±—Ä–∞–∂–µ–Ω—å
- –ë–µ–∑–ø–µ—á–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è —Ç–∏–ø—ñ–≤ —Ñ–∞–π–ª—ñ–≤

### üìß Email —Å–µ—Ä–≤—ñ—Å  
- **Mailhog** –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏ (SMTP –µ–º—É–ª—è—Ü—ñ—è)
- –í–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ–π–Ω—ñ –ª–∏—Å—Ç–∏ –∑ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–º–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º–∏
- –õ–∏—Å—Ç–∏ –¥–ª—è —Å–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—è

### üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö
- **Async PostgreSQL** —á–µ—Ä–µ–∑ asyncpg
- **SQLAlchemy 2.0** –∑ async —Å–µ—Å—ñ—è–º–∏
- **Alembic** –º—ñ–≥—Ä–∞—Ü—ñ—ó –∑ –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—î—é
- –Ü–Ω–¥–µ–∫—Å–∏ –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó –ø–æ—à—É–∫—É

### ‚ö° –ö–µ—à—É–≤–∞–Ω–Ω—è
- **Redis** –¥–ª—è –∫–µ—à—É–≤–∞–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- –ó–º–µ–Ω—à–µ–Ω–Ω—è –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ –±–∞–∑—É –¥–∞–Ω–∏—Ö
- TTL –¥–ª—è —Ç–æ–∫–µ–Ω—ñ–≤ —Å–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—è

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—ñ–≤
```bash
# –í—Å—ñ —Ç–µ—Å—Ç–∏
pytest

# –ó –ø–æ–∫—Ä–∏—Ç—Ç—è–º –∫–æ–¥—É
pytest --cov=app --cov-report=term-missing

# –¢—ñ–ª—å–∫–∏ unit —Ç–µ—Å—Ç–∏
pytest tests/services tests/crud tests/utils

# –¢—ñ–ª—å–∫–∏ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω—ñ —Ç–µ—Å—Ç–∏  
pytest tests/integration

# –î–µ—Ç–∞–ª—å–Ω–∏–π –≤–∏–≤—ñ–¥
pytest -v
```

### –ü–æ–∫—Ä–∏—Ç—Ç—è –∫–æ–¥—É
- **77% –∑–∞–≥–∞–ª—å–Ω–µ –ø–æ–∫—Ä–∏—Ç—Ç—è**
- **49 —Ç–µ—Å—Ç—ñ–≤** —É —Ä—ñ–∑–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö:
  - Unit —Ç–µ—Å—Ç–∏ –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü—ñ–π
  - Unit —Ç–µ—Å—Ç–∏ –¥–ª—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (auth, email, avatar, cache)
  - –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω—ñ —Ç–µ—Å—Ç–∏ –¥–ª—è API endpoints
  - –¢–µ—Å—Ç–∏ —É—Ç–∏–ª—ñ—Ç —Ç–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç—ñ–≤
```
tests/
‚îú‚îÄ‚îÄ conftest.py          # –§—ñ–∫—Åturi —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
‚îú‚îÄ‚îÄ db.py               # –¢–µ—Å—Ç–æ–≤–∞ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö
‚îú‚îÄ‚îÄ crud/               # –¢–µ—Å—Ç–∏ CRUD –º–æ–¥—É–ª—ñ–≤
‚îú‚îÄ‚îÄ services/           # –¢–µ—Å—Ç–∏ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏
‚îú‚îÄ‚îÄ integration/        # –¢–µ—Å—Ç–∏ API endpoints
‚îî‚îÄ‚îÄ utils/              # –¢–µ—Å—Ç–∏ –¥–æ–ø–æ–º—ñ–∂–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π
```

## –ú—ñ–≥—Ä–∞—Ü—ñ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

```bash
# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó –º—ñ–≥—Ä–∞—Ü—ñ—ó
alembic revision --autogenerate -m "–û–ø–∏—Å –∑–º—ñ–Ω"

# –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ–π
alembic upgrade head

# –í—ñ–¥–∫–∞—Ç –æ—Å—Ç–∞–Ω–Ω—å–æ—ó –º—ñ–≥—Ä–∞—Ü—ñ—ó  
alembic downgrade -1

# –Ü—Å—Ç–æ—Ä—ñ—è –º—ñ–≥—Ä–∞—Ü—ñ–π
alembic history
```

## Docker

### –°–µ—Ä–≤—ñ—Å–∏ –≤ docker-compose.yml
- **fastapi** ‚Äî –æ—Å–Ω–æ–≤–Ω–∏–π –¥–æ–¥–∞—Ç–æ–∫
- **postgres** ‚Äî –æ—Å–Ω–æ–≤–Ω–∞ –ë–î (–ø–æ—Ä—Ç 5432)
- **postgres_test** ‚Äî —Ç–µ—Å—Ç–æ–≤–∞ –ë–î (–ø–æ—Ä—Ç 5433)  
- **redis** ‚Äî –∫–µ—à —Ç–∞ —Å–µ—Å—ñ—ó (–ø–æ—Ä—Ç 6379)
- **mailhog** ‚Äî SMTP –µ–º—É–ª—è—Ç–æ—Ä (–ø–æ—Ä—Ç–∏ 1025, 8025)

### –ö–æ—Ä–∏—Å–Ω—ñ –∫–æ–º–∞–Ω–¥–∏
```bash
# –ü–µ—Ä–µ–±—É–¥–æ–≤–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤
docker compose up --build

# –ü–µ—Ä–µ–≥–ª—è–¥ –ª–æ–≥—ñ–≤
docker compose logs fastapi

# –ó—É–ø–∏–Ω–∫–∞ —Å–µ—Ä–≤—ñ—Å—ñ–≤  
docker compose down

# –û—á–∏—â–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
docker compose down -v
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ api/           # API —Ä–æ—É—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ crud/          # –û–ø–µ—Ä–∞—Ü—ñ—ó –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö  
‚îÇ   ‚îú‚îÄ‚îÄ models/        # SQLAlchemy –º–æ–¥–µ–ª—ñ
‚îÇ   ‚îú‚îÄ‚îÄ schemas/       # Pydantic —Å—Ö–µ–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ services/      # –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ config.py      # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îÇ   ‚îú‚îÄ‚îÄ database.py    # –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ main.py        # FastAPI –¥–æ–¥–∞—Ç–æ–∫
‚îú‚îÄ‚îÄ tests/             # –¢–µ—Å—Ç–∏ –∑ –ø–æ–∫—Ä–∏—Ç—Ç—è–º 77%
‚îú‚îÄ‚îÄ alembic/           # –ú—ñ–≥—Ä–∞—Ü—ñ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
‚îú‚îÄ‚îÄ docker-compose.yml # Docker —Å–µ—Ä–≤—ñ—Å–∏
‚îú‚îÄ‚îÄ Dockerfile         # –û–±—Ä–∞–∑ FastAPI
‚îî‚îÄ‚îÄ pyproject.toml     # Poetry –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
```

## –†–æ–∑—Ä–æ–±–∫–∞

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö endpoint'—ñ–≤
1. –°—Ç–≤–æ—Ä–∏—Ç–∏ Pydantic —Å—Ö–µ–º—É –≤ `schemas/`
2. –î–æ–¥–∞—Ç–∏ –º–æ–¥–µ–ª—å SQLAlchemy –≤ `models/`
3. –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ CRUD –æ–ø–µ—Ä–∞—Ü—ñ—ó –≤ `crud/`
4. –°—Ç–≤–æ—Ä–∏—Ç–∏ API —Ä–æ—É—Ç –≤ `api/`
5. –î–æ–¥–∞—Ç–∏ —Ç–µ—Å—Ç–∏ –≤ `tests/`
6. –°—Ç–≤–æ—Ä–∏—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é –∑ Alembic

### –ó–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è
–í—Å—ñ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω—ñ –¥–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ `.env` —Ñ–∞–π–ª—ñ:
- –ü–∞—Ä–æ–ª—ñ –±–∞–∑ –¥–∞–Ω–∏—Ö
- JWT —Å–µ–∫—Ä–µ—Ç–Ω—ñ –∫–ª—é—á—ñ  
- API –∫–ª—é—á—ñ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
- SMTP –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
